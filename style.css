/* style.css (V17 輪播修正版) */

/* 1. 基礎設定 */
* { box-sizing: border-box; margin: 0; padding: 0; user-select: none; -webkit-tap-highlight-color: transparent; font-family: -apple-system, BlinkMacSystemFont, sans-serif; }
:root { --bg-color: #F2EBE0; --primary-brown: #8D6E63; --text-dark: #5D4037; --card-size: min(85vw, 400px); }
body { background-color: var(--bg-color); width: 100vw; height: 100vh; overflow: hidden; position: fixed; }

/* 2. 滑動軌道 */
.carousel-track { display: flex; width: 300%; height: 100%; transform: translateX(-33.333%); will-change: transform; }
.page-container {
    width: 33.333%; height: 100%; flex-shrink: 0; position: relative; z-index: 1;
    display: flex; flex-direction: column; align-items: center; justify-content: center;
    padding-top: 80px; padding-bottom: 100px; overflow: hidden; 
}

/* 頁面特定設定 */
#page-memory { justify-content: flex-start; padding-top: 15px !important; z-index: 50; }
#page-community { width: 100%; padding: 80px 0 0 0 !important; justify-content: flex-start; background-color: #fff; }

.page-content-wrapper { width: 100%; height: 100%; display: flex; flex-direction: column; align-items: center; }

/* 3. Home Card */
.card {
    width: var(--card-size); height: var(--card-size); aspect-ratio: 1/1;
    background-color: #ddd; border-radius: 35px;
    background-image: url('https://images.unsplash.com/photo-1565299624946-b28f40a0ae38?ixlib=rb-1.2.1&auto=format&fit=crop&w=600&q=80');
    background-size: cover; background-position: center;
    box-shadow: 0 15px 30px rgba(93, 64, 55, 0.15);
    position: relative; overflow: hidden; margin: 0 auto; flex-shrink: 0; z-index: 5;
}
.card::before { content: ""; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(30, 30, 30, 0.6); z-index: 2; }

/* 4. UI Bars */
.top-bar, .bottom-bar {
    position: fixed; left: 50%; transform: translateX(-50%); width: 86%;
    display: flex; align-items: center; padding: 0 5px;
    z-index: 100; pointer-events: none; transition: opacity 0.3s;
}
.top-bar { top: max(60px, env(safe-area-inset-top)); justify-content: space-between; }
.bottom-bar { bottom: max(50px, env(safe-area-inset-bottom)); justify-content: center; gap: 60px; }
.btn-container { pointer-events: auto; cursor: pointer; transition: transform 0.1s; display: flex; justify-content: center; align-items: center; }
.btn-container:active { transform: scale(0.92); }
.avatar, .notification { width: 55px; height: 55px; background-color: #947867; border-radius: 50%; }
.search-pill { width: 120px; height: 45px; background-color: #947867; border-radius: 22px; display: flex; align-items: center; padding-left: 15px; margin: 0 auto; }
.shutter-btn { width: 76px; height: 76px; border: 5px solid #F2EBE0; background-color: #947867; border-radius: 50%; box-shadow: 0 0 0 4px #947867 inset; }
svg { fill: none; stroke-linecap: round; stroke-linejoin: round; }
.icon-white svg { stroke: white; stroke-width: 2; }
.icon-brown svg { stroke: #8D6E63; stroke-width: 2.5; width: 32px; height: 32px; }

/* 5. Calendar */
.calendar-container { width: 90%; max-width: 350px; margin: 0 auto; position: relative; z-index: 100 !important; pointer-events: auto !important; }
.weekdays { display: grid; grid-template-columns: repeat(7, 1fr); text-align: center; font-size: 14px; font-weight: bold; margin-bottom: 15px; }
.days { display: grid; grid-template-columns: repeat(7, 1fr); gap: 10px; row-gap: 20px; }
.day-cell { width: 100%; aspect-ratio: 1/1; display: flex; justify-content: center; align-items: center; font-size: 16px; color: #9E9E9E; border-radius: 50%; cursor: pointer; position: relative; z-index: 101; }
.day-cell.has-photo { background-size: cover; background-position: center; color: transparent; box-shadow: 0 2px 5px rgba(0,0,0,0.2); pointer-events: auto !important; }
.calendar-controls { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 10px; }
.month-nav-btn { background: none; border: none; font-size: 20px; color: #8D6E63; cursor: pointer; padding: 5px 10px; font-weight: bold; }

/* 6. 社群貼文 (Feed Card) - 多圖輪播關鍵樣式 */
.feed-card {
    width: 100% !important; margin: 0 !important; border-bottom: 1px solid #efefef;
    padding-bottom: 10px; border-radius: 0 !important; box-shadow: none !important;
    position: relative; display: flex; flex-direction: column;
}
.feed-header { display: flex; align-items: center; justify-content: space-between; padding: 10px 15px; }
.feed-user-info { display: flex; align-items: center; gap: 10px; }
.feed-avatar { width: 32px; height: 32px; background: #ddd; border-radius: 50%; }
.feed-username { font-weight: bold; font-size: 14px; color: #333; }
.feed-location { font-size: 11px; color: #999; }
.vip-badge { background: #FFD700; color: #000; font-size: 10px; padding: 2px 6px; border-radius: 4px; margin-left: 5px; font-weight: bold; }

/* style.css (修正輪播尺寸) */

/* 1. 輪播容器：寬高都設為 (螢幕寬 - 10px) */
.feed-carousel {
    display: flex; 
    overflow-x: auto; 
    scroll-snap-type: x mandatory;
    
    /* ⚠️ 關鍵：精準設定寬高 */
    width: calc(100vw - 10px) !important;
    height: calc(100vw - 10px) !important;
    
    /* 置中 (左右各 5px) */
    margin: 0 auto; 
    
    scrollbar-width: none;
}
.feed-carousel::-webkit-scrollbar { display: none; }

/* 2. 圖片：填滿容器，確保也是正方形 */
.feed-image {
    /* 讓圖片跟容器一樣大 */
    min-width: calc(100vw - 10px) !important;
    height: 100% !important; 
    
    background-size: cover; 
    background-position: center; 
    background-color: #eee;
    scroll-snap-align: start;
    flex-shrink: 0;
}

.feed-counter { position: absolute; top: 60px; right: 15px; background: rgba(0,0,0,0.6); color: white; font-size: 12px; padding: 4px 10px; border-radius: 12px; pointer-events: none; z-index: 10; }
.feed-actions { display: flex; gap: 15px; padding: 10px 15px; }
.feed-likes { padding: 0 15px; font-size: 13px; font-weight: bold; color: #333; margin-bottom: 5px; }
.feed-actions svg.liked { fill: #ED4956; stroke: #ED4956; animation: likeBounce 0.3s ease; }
@keyframes likeBounce { 0% {transform:scale(1);} 50% {transform:scale(1.2);} 100% {transform:scale(1);} }

/* 7. Story Mode */
#storyPage { background-color: #000; }
.story-container { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; }
.story-img-box { width: 100%; height: 100%; background-size: contain; background-repeat: no-repeat; background-position: center; }
.story-progress-bar { position: absolute; bottom: 60px !important; top: auto !important; left: 20px; right: 20px; display: flex; gap: 5px; z-index: 99999 !important; }
.progress-segment { flex: 1; height: 3px; background-color: rgba(255, 255, 255, 0.3); border-radius: 2px; }
.progress-segment.active { background-color: #fff; }

/* 8. 留言板 */
.comment-sheet {
    position: fixed; bottom: 0; left: 0; width: 100%; height: 75%;
    background-color: #fff; border-radius: 20px 20px 0 0;
    z-index: 99999 !important; transform: translateY(100%); transition: transform 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
    display: flex; flex-direction: column; box-shadow: 0 -5px 30px rgba(0,0,0,0.15);
}
.comment-sheet.active { transform: translateY(0); }
.comment-header { height: 50px; border-bottom: 1px solid #eee; display: flex; align-items: center; justify-content: center; font-weight: bold; color: #333; position: relative; }
.close-comment-btn { position: absolute; right: 15px; top: 0; height: 50px; display: flex; align-items: center; cursor: pointer; font-size: 24px; color: #999; }
.comment-list { flex: 1; overflow-y: auto; padding: 15px; }
.comment-item { display: flex; gap: 12px; margin-bottom: 20px; }
.comment-avatar { width: 36px; height: 36px; background: #ddd; border-radius: 50%; flex-shrink: 0; }
.comment-content { font-size: 14px; line-height: 1.4; color: #333; }
.comment-user { font-weight: bold; margin-right: 5px; color: #000; }
.comment-time { font-size: 11px; color: #999; margin-top: 4px; }
.comment-input-area { height: 60px; border-top: 1px solid #eee; display: flex; align-items: center; padding: 0 15px; background: #fff; padding-bottom: env(safe-area-inset-bottom); }
.comment-input { flex: 1; height: 40px; border: 1px solid #ddd; border-radius: 20px; padding: 0 15px; font-size: 14px; outline: none; }
.comment-send-btn { margin-left: 10px; color: #8D6E63; font-weight: bold; cursor: pointer; padding: 5px 10px; }

/* 9. 其他 */
.action-sheet { position: fixed; bottom: 0; left: 0; width: 100%; background-color: var(--bg-color); border-radius: 35px 35px 0 0; padding: 10px 25px 40px 25px; transform: translateY(100%); z-index: 450; transition: transform 0.3s; box-shadow: 0 -5px 20px rgba(0,0,0,0.1); }
.sheet-handle-area { width: 100%; height: 30px; display: flex; justify-content: center; align-items: center; margin-bottom: 10px; }
.sheet-handle { width: 40px; height: 5px; background-color: #D7CCC8; border-radius: 10px; }
.sheet-option { display: flex; align-items: center; padding: 18px 0; border-bottom: 1px solid #E0D4C8; color: var(--text-dark); font-weight: 600; cursor: pointer; }
.sheet-option svg { width: 24px; height: 24px; margin-right: 15px; stroke: var(--primary-brown); fill: none; stroke-width: 2; }
.modal-backdrop { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.4); opacity: 0; pointer-events: none; z-index: 400; transition: opacity 0.3s; }
.modal-backdrop.active { opacity: 1; pointer-events: auto; }
.profile-page, .editor-page { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: var(--bg-color); z-index: 300; transform: translateX(-100%); transition: transform 0.3s; display: flex; flex-direction: column; }
.profile-page.active { transform: translateX(0); }
.editor-page { transform: translateY(100%); z-index: 600; }
.editor-page.active { transform: translateY(0); }
.gallery-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 2px; overflow-y: auto; padding-top: 2px; flex: 1; }
.gallery-item { aspect-ratio: 1/1; background-color: #eee; background-size: cover; }
.preview-area { width: 100%; aspect-ratio: 1/1 !important; background-color: #ddd; background-size: cover; background-position: center; }
.editor-header { height: 50px; display: flex; justify-content: space-between; align-items: center; padding: 0 20px; margin-top: 10px !important; }
.editor-tools-bar { display: flex; gap: 10px; padding: 10px 15px; }
.tool-capsule { height: 36px; background: rgba(141, 110, 99, 0.1); border-radius: 18px; padding: 0 12px; display: flex; align-items: center; justify-content: center; cursor: pointer; }
/* 多選按鈕激活樣式 */
.tool-capsule.active { background-color: #8D6E63; color: white; } 
.tool-capsule.active svg { stroke: white; }
.gallery-add-btn { width: 100%; aspect-ratio: 1/1; background-color: #EFEBE9; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer; border: 2px dashed #8D6E63; color: #8D6E63; font-weight: bold; font-size: 14px; pointer-events: auto; }
.gallery-add-btn svg { width: 30px; height: 30px; margin-bottom: 5px; stroke: #8D6E63; }
.preview-placeholder { width: 100%; height: 100%; display: flex; justify-content: center; align-items: center; color: #999; font-size: 16px; background-color: #f0f0f0; }
